---
import Layout from '../../layouts/Layout.astro';
import PostList from '../../components/PostList.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog', ({ data }) => !data.draft);
  
  // Extract all unique tags
  const uniqueTags = [...new Set(allPosts.flatMap((post) => post.data.tags || []))];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) => 
      post.data.tags?.includes(tag)
    );
    // Sort posts by date
    const sortedPosts = filteredPosts.sort((a, b) => 
      b.data.date.getTime() - a.data.date.getTime()
    );
    
    return {
      params: { tag },
      props: { posts: sortedPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<Layout title={`Tag: ${tag} - Shedrack Akintayo`}>
  <div class="container mx-auto max-w-3xl px-4 py-16">
    <header class="py-12">
      <p class="text-muted-foreground">Tag</p>
      <h1 class="text-4xl font-bold tracking-tight sm:text-5xl mt-2">
        #{tag}
      </h1>
      <p class="mt-4 text-muted-foreground">
        {posts.length} post{posts.length === 1 ? '' : 's'} tagged with "{tag}"
      </p>
    </header>

    <section class="py-8">
      <PostList posts={posts} />
    </section>

    <div class="mt-12 pt-8 border-t border-border">
      <a 
        href="/tags" 
        class="text-sm text-muted-foreground transition-colors hover:text-foreground"
      >
        ‚Üê View all tags
      </a>
    </div>
  </div>
</Layout>
